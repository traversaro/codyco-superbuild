cmake_minimum_required(VERSION 2.8.11)
project(codyco-superbuild NONE)

## we have to enable C because it is currently used
## by CMake to describe packages (in Config*.cmake files)
enable_language(C)

list(APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")

set(CODYCO-SUPERBUILD_MAJOR_VERSION 0)
set(CODYCO-SUPERBUILD_MINOR_VERSION 1)
set(CODYCO-SUPERBUILD_PATCH_VERSION 0)
set(CODYCO-SUPERBUILD_VERSION ${CODYCO-SUPERBUILD_MAJOR_VERSION}.${CODYCO-SUPERBUILD_MINOR_VERSION}.${CODYCO-SUPERBUILD_PATCH_VERSION})

include(CTest)
include(FeatureSummary)

set(YCM_USE_CMAKE_PROPOSED TRUE CACHE BOOL "Use files including unmerged cmake patches")

#Add options
option(CODYCO_USES_WBI_TOOLBOX "Whole Body Interface Toolbox - Simulink library" FALSE)
option(CODYCO_USES_URDFDOM "Enable support for URDF input in iDynTree" TRUE)
option(CODYCO_TRAVIS_CI "Set if build is done with Travis-CI flags" FALSE)
option(CODYCO_ICUBWBI_USE_EXTERNAL_TORQUE_CONTROL "Set if iCub WBI implementation uses external torque control. False to use YARP Torque Control." FALSE)
option(CODYCO_BUILD_ICUB_MODEL_GENERATOR "Enable compilation of the icub-model-generator" FALSE)

# Bootstrap YCM
set(YCM_TAG xcode_fixes) 
include(YCMBootstrap)

include(FindOrBuildPackage)
include(YCMEPHelper)

# Require system dependencies 
find_package(Eigen3 3.2 REQUIRED)
find_package(Boost REQUIRED system thread)

if(CODYCO_USES_URDFDOM)
    find_or_build_package(kdl_format_io)
    message(STATUS "kdl_format_io is version: ${kdl_format_io_VERSION}")
endif()

find_or_build_package(YARP 2.3.60)
find_or_build_package(ICUB)
find_or_build_package(CoDyCo)

#modules
find_or_build_package(comStepper)

#WBI-Toolbox
if( ${CODYCO_USES_WBI_TOOLBOX} )
    find_or_build_package(WBIToolbox)
endif()

#icub-model-generator
if(${CODYCO_BUILD_ICUB_MODEL_GENERATOR})
    find_or_build_package(icub-model-generator)
endif()

#Documentation
add_subdirectory(doc)

set_package_properties(Git PROPERTIES TYPE RUNTIME)
set_package_properties(Subversion PROPERTIES TYPE RUNTIME)
set_package_properties(PkgConfig PROPERTIES TYPE RUNTIME)
set_package_properties(Doxygen PROPERTIES TYPE RUNTIME)

feature_summary(WHAT ALL INCLUDE_QUIET_PACKAGES FATAL_ON_MISSING_REQUIRED_PACKAGES)
